// ...existing code from adapter.rs...
